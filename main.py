import streamlit as st
import numpy as np
import pandas as pd
import joblib
from sklearn.tree import DecisionTreeClassifier
#pip install streamlit scikit-learn numpy pandas joblib

st.set_page_config(
    page_title="Ex-stream-ly Cool App",
    page_icon="üå±",
)


# ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•
data = {
    'temperature': [27,27,27,33,33,30,30,30,30,27,27,30,30,27,25,25,25,30],
    'soil_type': [1,3,4,5,3,2,3,5,4,5,4,4,6,1,1,3,5,5],   #1=‡∏î‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏ô, 2=‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß, 3=‡∏î‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß, 4=‡∏î‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏¢, 5=‡∏î‡∏¥‡∏ô‡∏£‡πà‡πà‡∏ß‡∏ô‡∏ó‡∏£‡∏≤‡∏¢, 6=‡∏î‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏õ‡∏ô‡∏ó‡∏£‡∏≤‡∏¢
    'rainfall': [800,800,800,1500,1500,1500,1500,1000,1000,1300,1300,800,800,1200,2000,2000,2000,1300],
    'soil_moisture': [75,75,75,75,75,85,85,75,75,65,65,65,65,75,60,60,60,65],
    'relative_humidity' : [65,65,65,75,75,80,80,65,65,75,75,65,65,85,75,75,75,65],
    'crop_type': [1,1,1,2,2,3,3,4,4,5,5,6,6,7,8,8,8,9]  #1=‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á, 2=‡∏≠‡πâ‡∏≠‡∏¢, 3=‡∏Ç‡πâ‡∏≤‡∏ß, 4=‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î, 5=‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á, 6=‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß, 7=‡∏ä‡∏≤, 8=‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏ô‡πâ‡∏≥‡∏´‡∏≠‡∏°, 9=‡∏´‡∏≠‡∏°‡πÅ‡∏î‡∏á
}

df = pd.DataFrame(data)
X = df.drop(columns=['crop_type'])
y = df['crop_type']

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ù‡∏∂‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•
model = DecisionTreeClassifier(criterion='entropy', max_depth=4, random_state=18)
model.fit(X, y)

# ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏°‡πÄ‡∏î‡∏•
joblib.dump(model, 'crop_model.pkl')

# ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•
model = joblib.load('crop_model.pkl')


st.title("üå± ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°")
st.subheader("‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°")

soil_type_options = {
    "‡∏î‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏ô": 1,
    "‡∏î‡∏¥‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß": 2,
    "‡∏î‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß": 3,
    "‡∏î‡∏¥‡∏ô‡∏ó‡∏£‡∏≤‡∏¢": 4,
    "‡∏î‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏ô‡∏ó‡∏£‡∏≤‡∏¢": 5,
    "‡∏î‡∏¥‡∏ô‡∏£‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß‡∏õ‡∏ô‡∏ó‡∏£‡∏≤‡∏¢": 6
}

col1, col2 = st.columns(2)
with col1:
    temperature = st.number_input("üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)", min_value=10, max_value=50, value=30)
    soil_type = soil_type_options[st.selectbox("üß± ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏î‡∏¥‡∏ô", options=list(soil_type_options.keys()))]
    rainfall = st.number_input("üåßÔ∏è ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ù‡∏ô (mm)", min_value=0, max_value=3000, value=1000)
with col2:
    soil_moisture = st.number_input("üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏î‡∏¥‡∏ô (%)", min_value=10, max_value=100, value=65)
    relative_humidity = st.number_input("üí¶ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ó‡∏ò‡πå (%)", min_value=10, max_value=100, value=70)

if st.button("üîç ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°"):
    user_input = np.array([[temperature, soil_type, rainfall, soil_moisture, relative_humidity]])
    prediction = model.predict(user_input)[0]
    crop_dict = {1: "ü•î ‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á", 2: "üåæ ‡∏≠‡πâ‡∏≠‡∏¢", 3: "üåæ ‡∏Ç‡πâ‡∏≤‡∏ß", 4: "üåΩ ‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î", 5: "ü•≠ ‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á", 
                 6: "üå± ‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", 7: "üçµ ‡∏ä‡∏≤", 8: "ü•• ‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß‡∏ô‡πâ‡∏≥‡∏´‡∏≠‡∏°", 9: "üßÖ ‡∏´‡∏≠‡∏°‡πÅ‡∏î‡∏á"}
    st.success(f"‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠: {crop_dict.get(prediction, '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ')}")

  