import streamlit as st
import numpy as np
import pandas as pd
import joblib
from sklearn.tree import DecisionTreeClassifier
#pip install streamlit scikit-learn numpy pandas joblib

st.set_page_config(
    page_title="Ex-stream-ly Cool App",
    page_icon="ğŸŒ±",
)


# à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸à¸¶à¸à¹‚à¸¡à¹€à¸”à¸¥
data = {
    'temperature': [27,27,27,33,33,30,30,30,30,27,27,30,30,27,25,25,25,30],
    'soil_type': [1,3,4,5,3,2,3,5,4,5,4,4,6,1,1,3,5,5],   #1=à¸”à¸´à¸™à¸£à¹ˆà¸§à¸™, 2=à¸”à¸´à¸™à¹€à¸«à¸™à¸µà¸¢à¸§, 3=à¸”à¸´à¸™à¸£à¹ˆà¸§à¸™à¹€à¸«à¸™à¸µà¸¢à¸§, 4=à¸”à¸´à¸™à¸—à¸£à¸²à¸¢, 5=à¸”à¸´à¸™à¸£à¹ˆà¹ˆà¸§à¸™à¸—à¸£à¸²à¸¢, 6=à¸”à¸´à¸™à¸£à¹ˆà¸§à¸™à¹€à¸«à¸™à¸µà¸¢à¸§à¸›à¸™à¸—à¸£à¸²à¸¢
    'rainfall': [800,800,800,1500,1500,1500,1500,1000,1000,1300,1300,800,800,1200,2000,2000,2000,1300],
    'soil_moisture': [75,75,75,75,75,85,85,75,75,65,65,65,65,75,60,60,60,65],
    'relative_humidity' : [65,65,65,75,75,80,80,65,65,75,75,65,65,85,75,75,75,65],
    'crop_type': [1,1,1,2,2,3,3,4,4,5,5,6,6,7,8,8,8,9]  #1=à¸¡à¸±à¸™à¸ªà¸³à¸›à¸°à¸«à¸¥à¸±à¸‡, 2=à¸­à¹‰à¸­à¸¢, 3=à¸‚à¹‰à¸²à¸§, 4=à¸‚à¹‰à¸²à¸§à¹‚à¸à¸”, 5=à¸¡à¸°à¸¡à¹ˆà¸§à¸‡, 6=à¸–à¸±à¹ˆà¸§à¹€à¸‚à¸µà¸¢à¸§, 7=à¸Šà¸², 8=à¸¡à¸°à¸à¸£à¹‰à¸²à¸§à¸™à¹‰à¸³à¸«à¸­à¸¡, 9=à¸«à¸­à¸¡à¹à¸”à¸‡
}

df = pd.DataFrame(data)
X = df.drop(columns=['crop_type'])
y = df['crop_type']

# à¸ªà¸£à¹‰à¸²à¸‡à¹à¸¥à¸°à¸à¸¶à¸à¹‚à¸¡à¹€à¸”à¸¥
model = DecisionTreeClassifier(criterion='entropy', max_depth=4, random_state=18)
model.fit(X, y)

# à¸šà¸±à¸™à¸—à¸¶à¸à¹‚à¸¡à¹€à¸”à¸¥
joblib.dump(model, 'crop_model.pkl')

# à¹‚à¸«à¸¥à¸”à¹‚à¸¡à¹€à¸”à¸¥
model = joblib.load('crop_model.pkl')


st.title("ğŸŒ± à¸£à¸°à¸šà¸šà¸„à¸²à¸”à¸à¸²à¸£à¸“à¹Œà¸à¸·à¸Šà¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡")
st.subheader("à¸à¸£à¸­à¸à¸„à¹ˆà¸²à¸•à¸±à¸§à¹à¸›à¸£à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡à¹€à¸à¸·à¹ˆà¸­à¸—à¸³à¸™à¸²à¸¢à¸à¸·à¸Šà¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡")


col1, col2 = st.columns(2)
with col1:
    temperature = st.number_input("ğŸŒ¡ï¸ à¸­à¸¸à¸“à¸«à¸ à¸¹à¸¡à¸´ (Â°C)", min_value=10, max_value=50, value=30)
    soil_type = st.number_input("ğŸ§± à¸›à¸£à¸°à¹€à¸ à¸—à¸”à¸´à¸™ (1-6)", min_value=1, max_value=6, value=1)
    rainfall = st.number_input("ğŸŒ§ï¸ à¸›à¸£à¸´à¸¡à¸²à¸“à¸à¸™ (mm)", min_value=0, max_value=3000, value=1000)
with col2:
    soil_moisture = st.number_input("ğŸ’§ à¸„à¸§à¸²à¸¡à¸Šà¸·à¹‰à¸™à¹ƒà¸™à¸”à¸´à¸™ (%)", min_value=10, max_value=100, value=65)
    relative_humidity = st.number_input("ğŸ’¦ à¸„à¸§à¸²à¸¡à¸Šà¸·à¹‰à¸™à¸ªà¸±à¸¡à¸à¸±à¸—à¸˜à¹Œ (%)", min_value=10, max_value=100, value=70)

if st.button("ğŸ” à¸—à¸³à¸™à¸²à¸¢à¸à¸·à¸Šà¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡"):
    user_input = np.array([[temperature, soil_type, rainfall, soil_moisture, relative_humidity]])
    prediction = model.predict(user_input)[0]
    crop_dict = {1: "ğŸ¥” à¸¡à¸±à¸™à¸ªà¸³à¸›à¸°à¸«à¸¥à¸±à¸‡", 2: "ğŸŒ¾ à¸­à¹‰à¸­à¸¢", 3: "ğŸŒ¾ à¸‚à¹‰à¸²à¸§", 4: "ğŸŒ½ à¸‚à¹‰à¸²à¸§à¹‚à¸à¸”", 5: "ğŸ¥­ à¸¡à¸°à¸¡à¹ˆà¸§à¸‡", 
                 6: "ğŸŒ± à¸–à¸±à¹ˆà¸§à¹€à¸‚à¸µà¸¢à¸§", 7: "ğŸµ à¸Šà¸²", 8: "ğŸ¥¥ à¸¡à¸°à¸à¸£à¹‰à¸²à¸§à¸™à¹‰à¸³à¸«à¸­à¸¡", 9: "ğŸ§… à¸«à¸­à¸¡à¹à¸”à¸‡"}
    st.success(f"à¸à¸·à¸Šà¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸ªà¸¡à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¸„à¸·à¸­: {crop_dict.get(prediction, 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸„à¸²à¸”à¸à¸²à¸£à¸“à¹Œà¹„à¸”à¹‰')}")
